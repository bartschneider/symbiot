# Development Dockerfile for Main React Application
# Optimized for ARM64 with hot reloading

FROM --platform=linux/arm64 node:20-alpine AS development

WORKDIR /app

# Install system dependencies
RUN apk add --no-cache \
    git \
    curl \
    bash

# Copy package files
COPY package*.json ./
COPY tsconfig*.json ./
COPY vite.config.ts ./

# Install dependencies
RUN npm ci --platform=linux --arch=arm64

# Copy source code (will be overridden by volume mounts in development)
COPY src/ ./src/
COPY public/ ./public/
COPY index.html ./

# Create non-root user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S synthora -u 1001 -G nodejs && \
    chown -R synthora:nodejs /app

USER synthora

# Expose ports for Vite dev server and HMR
EXPOSE 5173

# Set development environment variables
ENV NODE_ENV=development
ENV VITE_API_BASE_URL=http://localhost:3001
ENV VITE_APP_NAME="Synthora Analytics (Dev)"

# Start development server
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "5173", "--no-open"]